# Results
```{r results-source-descriptive-analysis, child = "markdown/descriptive_analysis.Rmd"}
```
```{r results-source-significance-testing, child = "markdown/significance_testing.rmd"}
```
```{r results-source-robust-classic, child = "markdown/robust_classic_analysis.Rmd"}
```
```{r results-source-diffusion-results, child = "markdown/diffusion_model_analysis/diffusion_model_results_report.Rmd"}
```
```{r results-source-diffusion-descriptive, child = "markdown/diffusion_model_analysis/ddm_descriptive_hierarch.Rmd"}
```
```{r results-source-diffusion-significance, child = "markdown/diffusion_model_analysis/ddm_significance_hierarch.Rmd"}
```


## Behavioral analysis
All analysis was conducted using `r r_citations$r`. `r r_citations$pkgs`
After data cleaning, `r nrow(final_data)` trials from `r demo_output$n_subjects - n_outliers` participants remained. Participants falsely responded in `r descriptive_output$mean_error_rate_nogo`% of NoGo trials resulting in a median `r average_n_location %>% filter(location == "E-1") %>% pull(median)` (SD = `r average_n_location %>% filter(location == "E-1") %>% pull(sd)`) trials prior to an error (E-1), and a median `r average_n_location %>% filter(location == "E+1") %>% pull(median)` (SD = `r average_n_location %>% filter(location == "E+1") %>% pull(sd)`) trials following an error (E+1) per participant.
**Descriptive results**

Highly significant main effects of RSI, `r apa_print(aov_rt_rsi_error_robust, es = "pes", mse = FALSE)$full_result$rsi` and error-condition, `r apa_print(aov_rt_rsi_error_robust, es = "pes", mse = FALSE)$full_result$error_code` on response time were observed. Response times were slower in the short RSI condition and slower following an error. Critically, the interaction between RSI and error-condition was highly significant, `r apa_print(aov_rt_rsi_error_robust, es = "pes", mse = FALSE)$full_result$rsi_error_code`. Post-hoc comparison reveals an increased influence of error-condition in the short RSI condition, manifesting in increased PES.

Comparison of mean accuracy between the 2x2 conditions yielded similar patterns of significant main effects of RSI `r apa_print(aov_acc_rsi_error_robust, es = "pes", mse = FALSE)$full_result$rsi` and error-condition `r apa_print(aov_acc_rsi_error_robust, es = "pes", mse = FALSE)$full_result$error_code` and a significant interaction effect, `r apa_print(aov_acc_rsi_error_robust, es = "pes", mse = FALSE)$full_result$rsi_error_code`. Errors committed in the short RSI condition lead to a more significant decrease in accuracy on the trial immediately following the error.

<!-- Highly significant main effects of RSI, `r apa_print(aov_rt_rsi_error_classic, es = "pes", mse = FALSE)$full_result$rsi` and accuracy of previous trial, `r apa_print(aov_rt_rsi_error_classic, es = "pes", mse = FALSE)$full_result$classic_pes_type` on reaction time were observed. Critically, the interaction between RSI and previous accuracy was highly significant, `r apa_print(aov_rt_rsi_error_classic, es = "pes", mse = FALSE)$full_result$rsi_classic_pes_type`. Post-hoc comparison reveals an increased influence of previous accuracy in the short RSI condition, manifesting in an increase in PES. -->

<!-- Comparison of mean accuracy between the 2x2 conditions yielded similar patterns of significant main effects of RSI `r apa_print(aov_acc_rsi_error_classic, es = "pes", mse = FALSE)$full_result$rsi` and previous accuracy `r apa_print(aov_acc_rsi_error_classic, es = "pes", mse = FALSE)$full_result$classic_pes_type` and a significant interaction effect, `r apa_print(aov_acc_rsi_error_classic, es = "pes", mse = FALSE)$full_result$rsi_classic_pes_type`. Errors committed in the short RSI condition lead to a more significant decrease in accuracy on the trial immediately following the error. -->

<!-- Highly significant main effects of RSI were observed on both response time `r apa_print(aov_rt_rsi_error_location, es = "pes", mse = FALSE)$full_result$rsi` and accuracy `r apa_print(aov_acc_rsi_error_location, es = "pes", mse = FALSE)$full_result$rsi`, caused by responses being faster and less accurate in short RSI condition. Main effects of _NoGo-accuracy_ on response time `r apa_print(aov_rt_rsi_error_location, es = "pes", mse = FALSE)$full_result$nogo_type` and accuracy `r apa_print(aov_acc_rsi_error_location, es = "pes", mse = FALSE)$full_result$nogo_type` were elicited by responses near correct NoGo trials being faster and more accurate. We also observed main effects of _distance_ on response time `r apa_print(aov_rt_rsi_error_location, es = "pes", mse = FALSE)$full_result$distance` and accuracy `r apa_print(aov_acc_rsi_error_location, es = "pes", mse = FALSE)$full_result$distance` with responses following a nogo trial being faster and less accurate. -->

<!-- Critically, we observed a significant interaction effects of _NoGo-accuracy_ and _distance_ on response time `r apa_print(aov_rt_rsi_error_location, es = "pes", mse = FALSE)$full_result$nogo_type_distance` and accuracy `r apa_print(aov_acc_rsi_error_location, es = "pes", mse = FALSE)$full_result$nogo_type_distance`. Responses around errors are faster than responses around correct NoGo trials prior to the NoGo trial and slower and less accurate following the NoGo trial. We furthermore observed a significant effect of RSI on this interaction, captured by the three-fold interaction between $RSI \times NoGo-accuracy \times distance$. **finish this** -->

### Global performance shifts
A multilevel model was fit to mean response time and accuracy data in each block for each participant allowing for random intercepts for each participant. The model revealed that overall, participants responded faster `r apa_print(lm_block_rt_overall)$full_result$block` and more accurate `r apa_print(lm_block_acc_overall)$full_result$block` in later blocks. Participants tended to respond slower `r apa_print(lm_trial_rt_overall)$full_result$trial` and less accurate `r apa_print(lm_trial_acc_overall)$full_result$trial` as the trial count within a block increased. **Count within block / over time?**

## Diffusion model
### Model comparisons
```{r result-model-comp, cache=TRUE, cache.extra = tools::md5sum(list.files("./markdown/diffusion_model_runs/cluster/output/model_comp/waic/", pattern = ".rda", full.names = TRUE))}

library(loo)
# Reading in all models
model_path <- "./markdown/diffusion_model_runs/cluster/output/model_comp/waic/"
base_model <- rio::import(paste0(model_path, "base_model_robust.rda"))
no_rsi_model <- rio::import(paste0(model_path, "no_rsi.rda"))
no_error_factor_model <- rio::import(paste0(model_path, "no_error_factor.rda"))

no_err_drift_model <- rio::import(paste0(model_path, "no_err_drift.rda"))
no_err_bs_model <- rio::import(paste0(model_path, "no_err_bs.rda"))
no_err_bias_model <- rio::import(paste0(model_path, "no_err_bias.rda"))
no_err_ndt_model <- rio::import(paste0(model_path, "no_err_ndt.rda"))

no_rsi_drift_model <- rio::import(paste0(model_path, "no_rsi_drift.rda"))
no_rsi_bs_model <- rio::import(paste0(model_path, "no_rsi_bs.rda"))
no_rsi_bias_model <- rio::import(paste0(model_path, "no_rsi_bias.rda"))
no_rsi_ndt_model <- rio::import(paste0(model_path, "no_rsi_ndt.rda"))

only_drift_model <- rio::import(paste0(model_path, "only_drift.rda"))
only_bias_model <- rio::import(paste0(model_path, "only_bias.rda"))
only_ndt_model <- rio::import(paste0(model_path, "only_ndt.rda"))
only_bs_model <- rio::import(paste0(model_path, "only_bs.rda"))

optimized_model <- rio::import(paste0(model_path, "optimized_model.rda"))

baseline_comp <- loo_compare(base_model, no_rsi_model, no_error_factor_model)

rsi_comp <- loo_compare(no_rsi_model, no_rsi_bias_model, no_rsi_drift_model, no_rsi_ndt_model, no_rsi_bs_model, base_model)

err_comp <- loo_compare(base_model, no_err_bias_model, no_err_drift_model, no_err_bs_model, no_err_ndt_model, no_error_factor_model)

only_comp <- loo_compare(no_error_factor_model, base_model, 
            only_drift_model, only_bs_model, only_ndt_model, only_bias_model)

optimized_comp <- loo_compare(base_model, optimized_model, no_rsi_bs_model, no_rsi_bias_model, no_rsi_model)
```

The base model was superior to all other models tested. Thus we retained the influence of both factors (RSI and location) on all parameters for analysis in the full location model. When restricting the influence of RSI on only one of the parameters, restricting its influence on the drift rate had the most detrimental effects. Constraining the bias and boundary separation to be equal across RSI conditions barely worsened predictive accuracy (see Table \@ref(tab:appendix-rsi-compare)). A similar pattern was found when restricting the impact of error-condition on only one of the parameters while allowing all other parameters to vary between pre- and post-error. Here, restricting the drift rate parameter again had the biggest negative impact on predictive accuracy (see Table \@ref(tab:appendix-err-compare)). When only allowing one of the four diffusion model parameters to vary between error-condition, drift rate again proved to be the single most important parameter for good predictive accuracy (see Table \@ref(tab:appendix-only-compare)).

### Model fit
We first ran non-hierarchical models, tested those for convergence and obtained posterior predictive response time distributions. We then compared empirical response time distributions to the predicted response time distribution for each condition. This revealed a serious discrepancy between the predicted response time distribution and the empirical distribution in post-error trials in the short RSI condition (see Figure  \@ref(fig:results-plot-ep1-bad-pred)). This also lead to issues when attempting to fit hierarchical models to data containing this condition. The exact impact and cause of this discrepancy will be discussed later, but we will refrain from interpreting the results in the short RSI condition. We therefore only fit hierarchical models to data in the long RSI condition.

The best-fitting model specification was used to estimate parameters in all 3 models and was then subjected to various model diagnostic tests. In the robust model, there were no divergent transitions, $\widehat{R} > 1.01$ or other signs of non-convergence [@gelman1992]. We visually inspected if the 4 chains mixed well for a few randomly selected parameters, observing no signs of misbehavior in the chains. We sampled the posterior parameter distribution 200 times, obtained predicted response time distributions from the sampled parameters and visually inspected them for appropriate model fit. 

We observed a large number of divergent transitions when fitting the classical model to our data. Inspections of $\widehat{R}$. Bulk- and tail effective sample size and trace plots of the MCMCM chains showed no signs of issues in the model. We will refrain from interpreting the parameters of the classical model here, but report the results in Appendix C. Main effects are of the same direction in both models.

```{r results-plot-ep1-bad-pred, warning = FALSE, fig.cap='Comparison of empirical and predicted response time distribution in short RSI condition for post-error trials'}
ep1 %>% 
  ggplot(
    aes(
      x = rt,
      fill = type,
      group = type
    )
  )+
  geom_density(alpha = 0.5)+
  labs(
    x = "Response time (in s)",
    y = "density",
    color = "Type"
  )+
  theme_classic()+
  xlim(0, 1)+
  theme(text = element_text(size = 15))
```

### Model results
Final analysis of the robust model was based on a total of `r model_robust_count %>% filter(error_factor == "post_error") %>% pull(total)` post-error and `r model_robust_count %>% filter(error_factor == "pre_error") %>% pull(total)` pre-error trials with a median of `r model_robust_count %>% filter(error_factor == "post_error") %>% pull(median)` and trials `r model_robust_count %>% filter(error_factor == "pre_error") %>% pull(median)` per participant. The model estimated a total of 24 group-level parameters.

Since significance tests are based on a minimum of 8000 iterations per condition, all differences presented here are highly significant. We choose to only report effect sizes and omit exact t-test results. 

We observed a significant decrease in drift rate in post-error trials compared to pre-error levels in the long RSI condition `r print_cohen(cohens_d_robust_drift)`. Boundary separation decreased `r print_cohen(cohens_d_robust_bs)`, non-decision time increased `r print_cohen(cohens_d_robust_ndt)` and starting point bias was reduced `r print_cohen(cohens_d_robust_bias)`.

We also compared trials prior to errors (E-1) to those preceding correct responses (C-1) to investigate _pre-error speeding_. The hierarchical model did not converge properly when attempting to estimate the short RSI condition. We again discarded data stemming from the short RSI condition and tried refitting the model in the long RSI condition with a higher adapt-delta.

Behaviorally we observed shorter response times prior to errors `r apa_print(aov_rt_pre_rsi, es = "pes", mse = FALSE)$full_result$location`, with the effect being more pronounced in the long RSI condition `r apa_print(aov_rt_pre_rsi, es = "pes", mse = FALSE)$full_result$rsi_location`.

In the long RSI condition we observed lower drift rates `r print_cohen(cohens_d_pre_long_drift)` and lower boundary separation in pre-error trials `r print_cohen(cohens_d_pre_long_bs)`. Non-decision time was lower `r print_cohen(cohens_d_pre_long_ndt)` and starting point bias was decreased `r print_mean_cohen(cohens_d_pre_long_bias)`^[Starting point bias was increased in the classical account].

```{r results-plots-robust, fig.cap='Group-level parameter estimates of mean of DDM parameters. Error bars represent 95% CrI.'}
plot(combined_robust_plot)
```

