---
editor_options:
  chunk_output_type: console
---
```{r ddm-significance-setup}
# Library calls
library(brms)
library(tidyverse)
library(tidybayes)
library(emmeans)
library(loo)
library(BayesFactor)
# library(effectsize)
library(effsize)
```

```{r ddm-significance-functions}
# Custom functions
calculate_evidence <- function(bs, bias){
  bs = abs(bs)
  start = bs * bias
  distance = bs - start
  return(distance)
}
```

```{r ddm-significance-data, cache = TRUE}
# Reading in data 
fit_robust <- rio::import("./markdown/diffusion_model_runs/cluster/output/hierarch_model_long_robust.rda")

fit_speed <- rio::import("./markdown/diffusion_model_runs/cluster/output/hierarch_model_speeding.rda")

fit_classic <- rio::import("./markdown/diffusion_model_runs/cluster/output/hierarch_model_long_classic.rda")


posterior_robust <- as_draws_df(
  fit_robust
)

posterior_speed <- as_draws_df(
  fit_speed
)

posterior_classic <- as_draws_df(
  fit_classic
)
```

```{r testing-robust-drift, cache = TRUE}
# Testing drift
posterior_robust_drift <- posterior_robust %>% 
  select(starts_with("b_error"))

colnames(posterior_robust_drift) <- c("post_error", "pre_error")

t_test_robust_drift <- t.test(posterior_robust_drift$pre_error, posterior_robust_drift$post_error)

cohens_d_robust_drift <- cohen.d(posterior_robust_drift$pre_error, posterior_robust_drift$post_error)
```

```{r testing-robust-bs, cache = TRUE}
# Testing drift
posterior_robust_bs <- posterior_robust %>% 
  select(starts_with("b_bs_error"))

colnames(posterior_robust_bs) <- c("post_error", "pre_error")

t_test_robust_bs <- t.test(posterior_robust_bs$pre_error, posterior_robust_bs$post_error)

cohens_d_robust_bs <- cohen.d(posterior_robust_bs$pre_error, posterior_robust_bs$post_error)
```

```{r testing-robust-ndt, cache = TRUE}
posterior_robust_ndt <- posterior_robust %>% 
  select(starts_with("b_ndt_error"))

colnames(posterior_robust_ndt) <- c("post_error", "pre_error")

t_test_robust_ndt <- t.test(posterior_robust_ndt$pre_error, posterior_robust_ndt$post_error)

cohens_d_robust_ndt <- cohen.d(posterior_robust_ndt$pre_error, posterior_robust_ndt$post_error)
```

```{r testing-robust-bias, cache = TRUE}
# Testing drift
posterior_robust_bias <- posterior_robust %>% 
  select(starts_with("b_bias_error"))

colnames(posterior_robust_bias) <- c("post_error",
                                     "pre_error")

t_test_robust_bias <- t.test(posterior_robust_bias$pre_error, posterior_robust_bias$post_error)

cohens_d_robust_bias <- cohen.d(posterior_robust_bias$pre_error, posterior_robust_bias$post_error)
```

```{r testing-evidece-robust, cache = TRUE}
posterior_robust_evidence <- posterior_robust %>% 
  mutate(
    evidence_pre_error = calculate_evidence(
      posterior_robust$b_bs_error_factorpre_error,
      posterior_robust$b_bias_error_factorpre_error
    ),
    evidence_post_error = calculate_evidence(
      posterior_robust$b_bs_error_factorpost_error,
      posterior_robust$b_bias_error_factorpost_error
    )
  ) %>% 
  select(starts_with("evidence"))

t_test_robust_evidence <- t.test(posterior_robust_evidence$evidence_pre_error,
                                 posterior_robust_evidence$evidence_post_error)
cohens_d_robust_evidence <- cohen.d(posterior_robust_evidence$evidence_pre_error,
                                 posterior_robust_evidence$evidence_post_error)
```

```{r testing-classic-drift, cache = TRUE}
# Testing drift
posterior_classic_drift <- posterior_classic %>% 
  select(starts_with("b_error"))

colnames(posterior_classic_drift) <- c("post_correct", "post_error")

t_test_classic_drift <- t.test(posterior_classic_drift$post_correct, posterior_classic_drift$post_error)

cohens_d_classic_drift <- cohen.d(posterior_classic_drift$post_correct, posterior_classic_drift$post_error)
```

```{r testing-classic-bs, cache = TRUE}
# Testing drift
posterior_classic_bs <- posterior_classic %>% 
  select(starts_with("b_bs_error"))

colnames(posterior_classic_bs) <- c("post_correct", "post_error")

t_test_classic_bs <- t.test(posterior_classic_bs$post_correct, posterior_classic_bs$post_error)

cohens_d_classic_bs <- cohen.d(posterior_classic_bs$post_correct, posterior_classic_bs$post_error)
```

```{r testing-classic-ndt, cache = TRUE}
posterior_classic_ndt <- posterior_classic %>% 
  select(starts_with("b_ndt_error"))

colnames(posterior_classic_ndt) <- c("post_correct", "post_error")

t_test_classic_ndt <- t.test(posterior_classic_ndt$post_correct, posterior_classic_ndt$post_error)

cohens_d_classic_ndt <- cohen.d(posterior_classic_ndt$post_correct, posterior_classic_ndt$post_error)
```

```{r testing-classic-bias, cache = TRUE}
# Testing drift
posterior_classic_bias <- posterior_classic %>% 
  select(starts_with("b_bias_error"))

colnames(posterior_classic_bias) <- c("post_correct", "post_error")

t_test_classic_bias <- t.test(posterior_classic_bias$post_correct, posterior_classic_bias$post_error)

cohens_d_classic_bias <- cohen.d(posterior_classic_bias$post_correct, posterior_classic_bias$post_error)

```


```{r testing-speed-drift, cache = TRUE}
# Testing drift
posterior_speed_drift <- posterior_speed %>% 
  select(starts_with("b_error"))

colnames(posterior_speed_drift) <- c("pre_correct", "pre_error")

t_test_speed_drift <- t.test(posterior_speed_drift$pre_correct, posterior_speed_drift$pre_error)

cohens_d_speed_drift <- cohen.d(posterior_speed_drift$pre_correct, posterior_speed_drift$pre_error)
```

```{r testing-speed-bs, cache = TRUE}
# Testing drift
posterior_speed_bs <- posterior_speed %>% 
  select(starts_with("b_bs_error"))

colnames(posterior_speed_bs) <- c("pre_correct", "pre_error")

t_test_speed_bs <- t.test(posterior_speed_bs$pre_correct, posterior_speed_bs$pre_error)

cohens_d_speed_bs <- cohen.d(posterior_speed_bs$pre_correct, posterior_speed_bs$pre_error)
```

```{r testing-speed-ndt, cache = TRUE}
posterior_speed_ndt <- posterior_speed %>% 
  select(starts_with("b_ndt_error"))

colnames(posterior_speed_ndt) <- c("pre_correct", "pre_error")

t_test_speed_ndt <- t.test(posterior_speed_ndt$pre_correct, posterior_speed_ndt$pre_error)

cohens_d_speed_ndt <- cohen.d(posterior_speed_ndt$pre_correct, posterior_speed_ndt$pre_error)
```

```{r testing-speed-bias, cache = TRUE}
# Testing drift
posterior_speed_bias <- posterior_speed %>% 
  select(starts_with("b_bias_error"))

colnames(posterior_speed_bias) <- c("pre_correct", "pre_error")

t_test_speed_bias <- t.test(posterior_speed_bias$pre_correct, posterior_speed_bias$pre_error)

cohens_d_speed_bias <- cohen.d(posterior_speed_bias$pre_correct, posterior_speed_bias$pre_error)

```
